#!/bin/sh
MSG_FILE="$1"
COMMIT_SOURCE="$2"

# merge/squash 스킵
if [ "$COMMIT_SOURCE" = "merge" ] || [ "$COMMIT_SOURCE" = "squash" ]; then exit 0; fi

# 브랜치명에서 키 추출
BRANCH=$(git symbolic-ref --short HEAD)
TICKET=$(echo "$BRANCH" | grep -oE '[A-Z]+-[0-9]+')
[ -z "$TICKET" ] && exit 0

# 첫 줄 불러오기
FIRST=$(head -n1 "$MSG_FILE")

# 이미 붙어있으면 스킵
echo "$FIRST" | grep -qE "^[A-Za-z]+:\s\[$TICKET\]\s" && exit 0

# 첫 줄만 sed 로 교체
# (type:) 콜론 포함   / \s* 공백 몽땅   / (\S.*) 공백 아닌 글자로 시작하는 제목
sed -i.bak -E "1s/^([A-Za-z]+:)\s*(\S.*)$/\1 [$TICKET] \1/" "$MSG_FILE"
